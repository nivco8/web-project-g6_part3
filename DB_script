# DB
Drop schema if exists web_project_g6;
create schema web_project_g6;
use web_project_g6;
DROP TABLE IF EXISTS USERS;
DROP TABLE IF EXISTS PRODUCTS;
DROP TABLE IF EXISTS ORDERS;
DROP TABLE IF EXISTS CART;
DROP TABLE IF EXISTS REVIEWS;
DROP TABLE IF EXISTS SEARCHES;
DROP TABLE IF EXISTS RETRIEVES;
DROP TABLE IF EXISTS ProductsInCart;




CREATE TABLE USERS(
    Email VARCHAR(100) NOT NULL UNIQUE,
    Password VARCHAR(50),
    FullName VARCHAR(50),
    Phone VARCHAR(50),
    Address VARCHAR(100),
    Birthday DATE,
    PRIMARY KEY (Email)
    );



CREATE TABLE PRODUCTS(
    ProductID MEDIUMINT NOT NULL UNIQUE AUTO_INCREMENT,
    ProductCategory BOOLEAN,
    Price DECIMAL(15,1),
    Information VARCHAR(200),
    PRIMARY KEY (ProductID)
);


CREATE TABLE ORDERS(
    OrderID MEDIUMINT NOT NULL UNIQUE AUTO_INCREMENT,
    CustomerEmail VARCHAR(100) NOT NULL,
    OrderDate VARCHAR(20),
    Address VARCHAR(100),
    Discount DECIMAL(15,1),
    ShippingCost INT,
    ConfirmationNumber VARCHAR(50),
    PRIMARY KEY (orderID),
    FOREIGN KEY (CustomerEmail) REFERENCES USERS(Email)
);

CREATE TABLE CART(
    CartID MEDIUMINT NOT NULL UNIQUE AUTO_INCREMENT,
    CustomerEmail VARCHAR(100) NOT NULL,
    Price DECIMAL(15,1),
    Address VARCHAR(100),
    Discount DECIMAL(15,1),
    ShippingCost INT,
    ConfirmationNumber VARCHAR(50),
    PRIMARY KEY (CartID),
    FOREIGN KEY (CustomerEmail) REFERENCES USERS(Email)
);


CREATE TABLE REVIEWS(
    ProductID MEDIUMINT NOT NULL,
    CustomerEmail VARCHAR(100) NOT NULL,
    ReviewDT DATETIME,
    Stars INT,
    Content VARCHAR(20),
    PRIMARY KEY (ProductID, CustomerEmail),
    FOREIGN KEY (CustomerEmail) REFERENCES USERS(Email),
    FOREIGN KEY (ProductID) REFERENCES PRODUCTS(ProductID),
    CONSTRAINT CK_Stars CHECK (Stars in (1,2,3,4,5))
);


CREATE TABLE SEARCHES(
    IPaddress VARCHAR(40) NOT NULL,
    SearchDT DATETIME NOT NULL,
    CustomerEmail VARCHAR(100) NOT NULL,
    Keyword VARCHAR(30),
    PRIMARY KEY (IPaddress, SearchDT),
    FOREIGN KEY (CustomerEmail) REFERENCES USERS(Email)
);


CREATE TABLE RETRIEVES(
    ProductID MEDIUMINT NOT NULL,
    SearchDT DATETIME NOT NULL,
    IPaddress VARCHAR(40) NOT NULL,
    Quantity INT NOT NULL,
    PRIMARY KEY (IPaddress, SearchDT, ProductID),
    CONSTRAINT fk_searches FOREIGN KEY (IPaddress) REFERENCES SEARCHES(IPaddress),
    #, IPaddress),
    FOREIGN KEY (ProductID) REFERENCES PRODUCTS(ProductID)
   # FOREIGN KEY () REFERENCES SEARCHES(IPaddress)
);


CREATE TABLE ProductsInCart(
    CustomerEmail VARCHAR(100) NOT NULL,
    ProductID MEDIUMINT NOT NULL,
    SaveDT DATETIME NOT NULL,
    PRIMARY KEY (CustomerEmail, ProductID),
    FOREIGN KEY (ProductID) REFERENCES PRODUCTS(ProductID),
    FOREIGN KEY (CustomerEmail) REFERENCES USERS(Email)
);


INSERT INTO PRODUCTS(ProductID,ProductCategory,Price,Information) VALUES ('1',TRUE,150,'עוגת שוקולד');

